---
- hosts: lb
  become: true
  become_method: sudo
  become_user: root
  pre_tasks:
    - name: install ler53 packages
      apt:
        state: present
        name:
          - python3-pip
          - python3-boto
          - python3-openssl
  roles:
  - role: hyperbola-lb
    hyperbola_environment: local
  - role: mprahl.lets-encrypt-route-53
    ler53_agreement: "https://letsencrypt.org/documents/LE-SA-v1.2-November-15-2017.pdf"
    ler53_cert_common_name: local.hyperboladc.net
    ler53_cert_sans:
      - app-local.hyperboladc.net
      - lb-local.hyperboladc.net
    ler53_route_53_domain: hyperboladc.net
    ler53_aws_access_key: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          62356433303466316131663536376231613836656639346635636633636436343138353364313864
          6138643137653565303633636566326437363338393930360a633830666137313035353637623235
          33643730333364336434646665653430663437343530666533333037613136306236363335383364
          6165613431396163390a333063326665383636663535336466336230353765666632316330633630
          31373733393130373835356431363865666438323764663535396639646432326239
    ler53_aws_secret_key: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          66303436373337373338323865316165633835623639663433356330343763316330626238653261
          6362363733343637333239326265363330373065616666610a356265373331613861323762343265
          61306634663962653932666363633238373737633732613265646639316636313139663934383338
          3563386633663063340a316462636664626336613439636330316632353937616631656531303165
          32636537303266356132303234383064663965613333396138306339303961653536306435623961
          6636353838336237323662393661653135616336653631633637
  post_tasks:
    - name: reload nginx
      systemd:
        name: nginx
        state: reloaded
