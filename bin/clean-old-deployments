#!/usr/bin/env bash

set -e

USAGE="$0 -d /path/to/directory

This script removes all but the 5 most recent subdirectories of
the supplied directory.
"

DIR=""

while getopts "h?d:" opt; do
    case "$opt" in
    h|\?)
        echo "$USAGE"
        exit 0
        ;;
    d)  DIR="$OPTARG"
        ;;
    *)  echo "$USAGE"
        exit 1
        ;;
    esac
done

if [ ! -d "$DIR" ]; then
    echo "$USAGE"
    echo
    echo "$DIR is not a valid directory."
    exit 1
fi

cd "$DIR"
ls -d -t -c -F -- ./* | grep '/$' | tail -n +6 | xargs -i rm -rf "{}"
