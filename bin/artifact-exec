#!/bin/bash

# Source artifact-specific .env configuration and then exec
# the program supplied via ARGV.

unset CDPATH

ARTIFACT_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")/.." && pwd)"

if [[ ! -d "$ARTIFACT_ROOT/env" ]]; then
	echo >&2 "No env directory to source"
	echo >&2 "ARTIFACT_ROOT=$ARTIFACT_ROOT"
	exit 1
fi

for env in "$ARTIFACT_ROOT/env/"*.env; do
	# shellcheck source=/dev/null
	. "$env"
done

exec "$@"
