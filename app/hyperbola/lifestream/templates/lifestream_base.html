{% extends "base.html" %}

{% load cache pipeline %}
{% block active_app %} lifestream {% endblock active_app %}
{% block title %} {{ block.super }} :: lifestream {% endblock title %}
{% block section_title %} Lifestream {% endblock section_title %}

{% block head %}
  {{ block.super }}
  {% stylesheet "lightbox" %}
  <!-- feed discovery -->
  <link rel="alternate" type="application/rss+xml" title="hyperbo.la lifestream (RSS)" href="{% url "lifestream:rss" %}">
  <link rel="alternate" type="application/atom+xml" title="hyperbo.la lifestream (Atom)" href="{% url "lifestream:atom" %}">
  <script>
    var HyperbolaDateFormatter=function(){"use strict";var e=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],t=function(e){return("0"+e).slice(-2)},n=function(n){return t(n.getHours())+":"+t(n.getMinutes())+" "+e[n.getMonth()]+" "+t(n.getDate())+" "+n.getFullYear()};return{write:function(e){var t=new Date;t.setTime(e*1e3),document.write(n(t))}}}();
  </script>
{% endblock head %}

{% block footer %}
  {{ block.super }}
  {% javascript "lightbox" %}
{% endblock footer %}

{% block content %}
<div class="row">
  <div class="col-md-8">
    {% if content_header %}
    <h2>{{ content_header|escape }}</h2>
    {% endif %}
    {% block lifestream_content %}{% endblock lifestream_content %}
  </div>
  {% cache 600 lifestream:sidebar %}
  <div class="col-md-4">
    <h3>Syndication</h3>
    <ul class="list-unstyled">
      <li class="feed-icon"><a href="{% url "lifestream:rss" %}">RSS</a></li>
      <li class="feed-icon"><a href="{% url "lifestream:atom" %}">Atom</a></li>
    </ul>
    {% regroup dates by month.year as archive %}
    {% for year in archive %}
    <h3>{{ year.grouper|escape }}</h3>
    <div class="row"><div class="col-md-6">
    <ul class="list-unstyled">
    {% for d in year.list %}
    <li><a href="{% url "lifestream:archive" d.month|date:"Y" d.month|date:"m" %}">{{ d.month|date:"F" }}</a> <span class="badge pull-right">{{ d.post_count|escape }}</span></li>
    {% endfor %}
    </ul>
    </div></div>
    {% endfor %}
  </div>
  {% endcache %}
</div>
{% endblock content %}
