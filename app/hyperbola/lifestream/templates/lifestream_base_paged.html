{% extends "lifestream_base.html" %}

{% load cache thumbnail hashtagize %}

{% block title %}
hyperbo.la :: lifestream{% if posts.number != 1 %} :: page {{ posts.number|escape }}{% endif %}
{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-8">
    <h2>{% block lifestream-posts-header %}{% endblock %}</h2>
    {% for post in posts %}
    <div class="panel panel-hyperbola">
      <div class="panel-heading lifestream-entry-header">
      <span class="date">
        <script>HyperbolaDateFormatter.write({{ post.pub_date|date:"U" }})</script>
        <noscript>
          {{ post.pub_date|date:"H:i T b d Y"|lower }}
        </noscript>
      </span>
      <a href="{% url "lifestream-entry-permalink" post.pk %}">permalink</a>
      </div>
      <div class="panel-body">
      {% if post.lifestreampicture %}
      {% thumbnail post.lifestreampicture.picture "500" as thumb %}
      {% thumbnail post.lifestreampicture.picture "1000" as large_thumb %}
      {% thumbnail post.lifestreampicture.picture "2000" as xlarge_thumb %}
      <div>
        <a data-toggle="lightbox" href="#lightbox-{{ post.id|escape }}">
          <img alt="Photo for post {{ post.id|escape }}" src="{{ thumb.url|escape }}" data-at2x="{{ large_thumb.url|escape }}" width="{{ thumb.width|escape }}" height="{{ thumb.height|escape }}" class="center-block img-thumbnail img-thumbnail-hyperbola">
        </a>
      </div>
      <div id="lightbox-{{ post.id|escape }}" class="lightbox fade hyperbola-lightbox" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="lightbox-dialog">
          <div class="lightbox-content hyperbola-lightbox-content">
            <img alt="Photo for post {{ post.id|escape }}" src="{{ large_thumb.url|escape }}" data-at2x="{{ xlarge_thumb.url|escape }}" width="{{ large_thumb.width|escape }}" height="{{ large_thumb.height|escape }}">
            <div class="lightbox-caption">
              <p class="lifestream-content">{{ post.blurb|urlize|hashtagize }}</p>
            </div>
          </div>
        </div>
      </div>
      {% endthumbnail %}
      {% endthumbnail %}
      {% endthumbnail %}
      {% endif %}
      <p class="lifestream-content">{{ post.blurb|urlize|hashtagize }}</p>
    </div>
    </div>
    {% endfor %}
    {% block lifestream-page-links %}{% endblock %}
  </div>
  {% cache 600 lifestream-sidebar %}
  <div class="col-md-4">
    <h3>Syndication</h3>
    <ul class="list-unstyled">
      <li class="feed-icon"><a href="{% url "lifestream-rss" %}">RSS</a></li>
      <li class="feed-icon"><a href="{% url "lifestream-atom" %}">Atom</a></li>
    </ul>
    {% for d in dates %}
    {% ifchanged d.month.year %}
    {% if not forloop.first %}
    </ul>
    </div></div>
    {% endif %}
    <h3>{{ d.month|date:"Y" }}</h3>
    <div class="row"><div class="col-md-6">
    <ul class="list-unstyled">
    {% endifchanged %}
    {% ifchanged d.month.year d.month.month %}
    <li><a href="{% url "lifestream-archive" d.month|date:"Y" d.month|date:"m" %}">{{ d.month|date:"F" }}</a> <span class="badge pull-right">{{ d.post_count|escape }}</span></li>
    {% endifchanged %}
    {% if forloop.last %}
    </ul>
    </div></div>
    {% endif %}
    {% endfor %}
  </div>
  {% endcache %}
</div>
{% endblock %}
